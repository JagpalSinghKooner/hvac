---
import { getEntry, getCollection, type CollectionEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const businessProfile = await getEntry('business', 'profile');

  if (!businessProfile || !businessProfile.data.services?.list || !businessProfile.data.coverage?.regions) {
    throw new Error('Business profile missing required services or coverage data');
  }

  const allServices = Object.values(businessProfile.data.services.list).flat();
  const allLocations = businessProfile.data.coverage.regions.flatMap((r) => r.locations);

  const paths = [];
  for (const service of allServices) {
    for (const location of allLocations) {
      const urlSlug = `${service.slug}-${location.slug}-on`;

      paths.push({
        params: { serviceLocation: urlSlug },
        props: {
          service,
          location,
        },
      });
    }
  }

  return paths;
}

type Props = {
  service: { title: string; slug: string };
  location: { name: string; slug: string };
};

const { service, location } = Astro.props;

const businessProfile = await getEntry('business', 'profile');
if (!businessProfile) {
  throw new Error('Business profile not found');
}
const business = businessProfile.data;

const seoTitle = `${service.title} in ${location.name}, ON | ${business.business.legal_name}`;
const seoDescription = `Professional ${service.title.toLowerCase()} services in ${location.name}, Ontario.`;
---

<BaseLayout
  title={seoTitle}
  description={seoDescription}
>
  <h1>{service.title} in {location.name}</h1>
</BaseLayout>
