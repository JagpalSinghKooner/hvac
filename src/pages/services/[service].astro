---
import { getCollection, type CollectionEntry, getEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const allServices = await getCollection('services');
  const publishedServices = allServices.filter(
    (service) => service.data.status === 'live' && service.data.workflowStatus === 'published'
  );

  return publishedServices.map((service) => ({
    params: { service: service.slug },
    props: { service },
  }));
}

type Props = {
  service: CollectionEntry<'services'>;
};

const { service } = Astro.props;

const businessProfile = await getEntry('business', 'profile');
if (!businessProfile) {
  throw new Error('Business profile not found');
}
const business = businessProfile.data;
---

<BaseLayout
  title={service.data.seoTitle || `${service.data.title} | ${business.business.legal_name}`}
  description={service.data.seoDescription || service.data.description}
>
  <h1>{service.data.title}</h1>
</BaseLayout>
