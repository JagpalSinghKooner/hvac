---
import { getCollection, type CollectionEntry, getEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const allRegions = await getCollection('regions');
  const publishedRegions = allRegions.filter((region) => region.data.workflowStatus === 'published');

  return publishedRegions.map((region) => ({
    params: { region: region.slug },
    props: { region },
  }));
}

type Props = {
  region: CollectionEntry<'regions'>;
};

const { region } = Astro.props;

const businessProfile = await getEntry('business', 'profile');
if (!businessProfile) {
  throw new Error('Business profile not found');
}
const business = businessProfile.data;
---

<BaseLayout
  title={region.data.seoTitle || `${region.data.title} | ${business.business.legal_name}`}
  description={region.data.seoDescription || region.data.description}
>
  <h1>{region.data.title}</h1>
</BaseLayout>
