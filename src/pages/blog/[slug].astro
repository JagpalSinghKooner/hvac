---
import { getCollection, type CollectionEntry, getEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  const publishedPosts = allPosts.filter((post) => post.data.workflowStatus === 'published');

  return publishedPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

type Props = {
  post: CollectionEntry<'blog'>;
};

const { post } = Astro.props;

const businessProfile = await getEntry('business', 'profile');
if (!businessProfile) {
  throw new Error('Business profile not found');
}
const business = businessProfile.data;
---

<BaseLayout
  title={post.data.seoTitle || `${post.data.title} | ${business.business.legal_name}`}
  description={post.data.seoDescription || post.data.description}
>
  <h1>{post.data.title}</h1>
</BaseLayout>
