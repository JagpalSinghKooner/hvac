---
import { getCollection, getEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import FAQFilter from '@/components/sections/FAQFilter';
import FinalCTASection from '@/components/sections/FinalCTASection.astro';

// Get business profile
const businessProfile = await getEntry('business', 'profile');
if (!businessProfile) {
  throw new Error('Business profile not found');
}
const business = businessProfile.data.business;
const reputation = businessProfile.data.reputation;

// Query all live FAQs
const allFaqs = await getCollection('faqs', ({ data }) => {
  return data.status === 'live';
});

// Sort FAQs by priority
const sortedFaqs = allFaqs
  .sort((a, b) => a.data.priority - b.data.priority)
  .map((faq) => ({
    question: faq.data.question,
    answer: faq.data.answer,
    scopes: faq.data.scopes,
  }));
---

<BaseLayout
  title={`Frequently Asked Questions | ${business.legal_name}`}
  description="Find answers to common questions about HVAC installation, repair, and maintenance services. Get expert advice from B.A.P Heating & Cooling."
>
  <!-- Hero Section -->
  <section class="py-16 md:py-24 bg-gradient-to-b from-muted/50 to-background">
    <div class="container mx-auto px-4 md:px-6 max-w-7xl">
      <div class="max-w-3xl mx-auto text-center space-y-4">
        <h1 class="text-4xl md:text-5xl font-bold tracking-tight">
          Frequently Asked Questions
        </h1>
        <p class="text-lg text-muted-foreground">
          Get answers to common questions about our HVAC services, from installation to maintenance.
        </p>
        <div class="flex items-center justify-center gap-4 text-sm text-muted-foreground">
          <span class="font-medium">Since {business.established_year}</span>
          <span class="text-muted-foreground/40">•</span>
          <span class="font-medium flex items-center gap-1">
            <span class="text-yellow-500">★</span>
            {reputation.google_rating} from {reputation.google_review_count}+ reviews
          </span>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQs Section with Search/Filter -->
  <section class="py-16 md:py-24">
    <div class="container mx-auto px-4 md:px-6 max-w-4xl">
      <FAQFilter faqs={sortedFaqs} client:load />
    </div>
  </section>

  <!-- Final CTA -->
  <FinalCTASection />
</BaseLayout>
