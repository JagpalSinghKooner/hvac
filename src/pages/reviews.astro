---
import { getCollection } from 'astro:content';

const allReviews = await getCollection('reviews');

// Filter and sort published reviews by priority
const publishedReviews = allReviews
  .filter((review) => review.data.status === 'live' && review.data.workflowStatus === 'published')
  .sort((a, b) => b.data.priority - a.data.priority);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Customer Reviews & Testimonials | B.A.P Heating & Cooling</title>
    <meta name="description" content="Read verified customer reviews and testimonials for B.A.P Heating & Cooling Services in Ontario." />
  </head>
  <body>
    <main>
      <header>
        <h1>Customer Reviews & Testimonials</h1>
        <p>See what our customers say about our HVAC services</p>
      </header>

      <section>
        {
          publishedReviews.map((review) => (
            <article>
              <div>
                <strong>{review.data.authorName}</strong>
                {review.data.verified && <span> (Verified)</span>}
              </div>
              <div>
                Rating: {'⭐'.repeat(review.data.rating)}
              </div>
              <p>{review.data.text}</p>
              <p>
                <small>
                  Service: {review.data.serviceSlug}
                  {review.data.citySlug && ` • Location: ${review.data.citySlug}`}
                  {' • '}
                  {review.data.reviewDate}
                  {' • '}
                  Source: {review.data.source}
                </small>
              </p>
              <hr />
            </article>
          ))
        }
      </section>
    </main>
  </body>
</html>
