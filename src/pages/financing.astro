---
import { getEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Section from '@/components/layout/Section.astro';
import Container from '@/components/layout/Container.astro';
import BenefitsSection from '@/components/sections/BenefitsSection.astro';
import ProcessSteps from '@/components/sections/ProcessSteps.astro';
import FAQAccordion from '@/components/sections/FAQAccordion.astro';
import PhoneCTA from '@/components/cta/PhoneCTA.astro';
import BookingCTA from '@/components/cta/BookingCTA.astro';
import QuickQuoteConversionSection from '@/components/sections/QuickQuoteConversionSection.astro';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import * as Icons from 'lucide-react';

// Data imports
import { getFinancingFAQs } from '@/data/faqs';
import {
  financingBenefits,
  financingPartners,
  financingProcessSteps,
} from '@/data/financingContent';

// Fetch business profile
const businessProfile = await getEntry('business', 'profile');
if (!businessProfile) {
  throw new Error('Business profile not found');
}
const business = businessProfile.data;

// Get financing FAQs
const faqs = getFinancingFAQs();

// SEO metadata
const seoTitle = 'HVAC Financing Options | 0% APR Available | B.A.P Heating Guelph';
const seoDescription = 'Flexible HVAC financing with 0% APR promotional offers, quick approval, and no upfront payment required. Access government rebates and utility programs in Ontario. Apply today!';

// Breadcrumbs
const breadcrumbs = [
  { label: 'Home', href: '/' },
  { label: 'Financing', href: '/financing' },
];
---

<BaseLayout title={seoTitle} description={seoDescription} breadcrumbs={breadcrumbs}>
  <!-- 1. Hero - gradient-cool -->
  <Section background="gradient-cool" padding="lg">
    <Container size="narrow" class="text-center">
      <h1 class="font-display text-display-md lg:text-display-lg tracking-tight">
        Flexible Financing Options
      </h1>
      <p class="mt-6 font-body text-body-lg text-gray-600 max-w-2xl mx-auto">
        Make your HVAC upgrade affordable with 0% APR promotional financing, flexible payment terms, and quick approval. No upfront payment required.
      </p>
      <div class="mt-8">
        <PhoneCTA variant="hero" showBadge={false}>
          <span slot="text">Get Pre-Qualified</span>
        </PhoneCTA>
      </div>
    </Container>
  </Section>

  <!-- 2. Benefits Section - white background -->
  <BenefitsSection
    benefits={financingBenefits}
    heading="Why Choose Financing for Your HVAC Upgrade?"
    subheading="Spread the cost of your new heating or cooling system with affordable monthly payments"
    columns={2}
  />

  <!-- 3. Financing Partners Section - muted (gray-50) -->
  <Section background="muted" fullWidth padding="lg">
    <Container>
      <div class="text-center mb-12">
        <h2 class="font-heading text-h2 mb-4">
          Government & Financing Programs Available
        </h2>
        <p class="font-body text-body-lg text-gray-600 max-w-3xl mx-auto">
          Access government-backed loans, utility rebates, and private financing options to make your HVAC investment affordable. We help you navigate all available programs in Ontario.
        </p>
      </div>

      <div class="grid gap-6 md:grid-cols-2">
        {financingPartners.map((partner) => {
          const IconComponent = (Icons as any)[partner.icon] || Icons.CheckCircle;

          return (
            <Card className="h-full flex flex-col">
              <CardHeader>
                <div class="flex items-start gap-4">
                  <div class="w-12 h-12 rounded-full flex items-center justify-center bg-primary/10 shrink-0">
                    <IconComponent className="h-6 w-6 text-primary" aria-hidden="true" />
                  </div>
                  <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2 flex-wrap">
                      <CardTitle className="text-xl">{partner.name}</CardTitle>
                      <Badge variant={
                        partner.type === 'government' ? 'default' :
                        partner.type === 'utility' ? 'secondary' :
                        'outline'
                      }>
                        {partner.type === 'government' ? 'Government' :
                         partner.type === 'utility' ? 'Utility Rebate' :
                         'Private'}
                      </Badge>
                    </div>
                    <p class="text-sm text-muted-foreground">{partner.description}</p>
                  </div>
                </div>
              </CardHeader>
              <CardContent className="flex-1 space-y-4">
                <!-- Key Features -->
                <div>
                  <h4 class="font-semibold text-sm mb-2">Key Features:</h4>
                  <ul class="space-y-1 text-sm text-muted-foreground">
                    {partner.keyFeatures.map((feature) => (
                      <li class="flex gap-2">
                        <span class="text-primary shrink-0">✓</span>
                        <span>{feature}</span>
                      </li>
                    ))}
                  </ul>
                </div>

                <!-- Program Details -->
                {(partner.amount || partner.interestRate) && (
                  <div class="grid grid-cols-2 gap-4 pt-4 border-t">
                    {partner.amount && (
                      <div>
                        <p class="text-xs text-muted-foreground">Amount</p>
                        <p class="font-semibold text-sm">{partner.amount}</p>
                      </div>
                    )}
                    {partner.interestRate && (
                      <div>
                        <p class="text-xs text-muted-foreground">Rate</p>
                        <p class="font-semibold text-sm">{partner.interestRate}</p>
                      </div>
                    )}
                  </div>
                )}

                <!-- Eligibility -->
                <div class="pt-2">
                  <p class="text-xs text-muted-foreground mb-1">Eligibility:</p>
                  <p class="text-sm">{partner.eligibility}</p>
                </div>

                <!-- Learn More Link -->
                {partner.applicationUrl && (
                  <a
                    href={partner.applicationUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="inline-flex items-center text-sm text-primary hover:underline"
                  >
                    Learn more
                    <Icons.ExternalLink className="ml-1 h-3 w-3" />
                  </a>
                )}
              </CardContent>
            </Card>
          );
        })}
      </div>

      <!-- Help Text -->
      <div class="mt-8 text-center">
        <p class="text-muted-foreground">
          <strong>Need help navigating these programs?</strong> We assist with all rebate paperwork and help you maximize available incentives. Call us for guidance.
        </p>
      </div>
    </Container>
  </Section>

  <!-- 4. Benefits Section continued - primary-light (bg-primary-50/30) -->
  <Section background="primary-light" fullWidth>
    <BenefitsSection
      benefits={financingBenefits.slice(2)}
      columns={2}
    />
  </Section>

  <!-- 5. Process Steps - white background -->
  <ProcessSteps steps={financingProcessSteps} />

  <!-- 6. FAQ Section - muted (gray-50) -->
  {faqs && faqs.length > 0 && (
    <Section background="muted" fullWidth>
      <FAQAccordion faqs={faqs} />
    </Section>
  )}

  <!-- 7. Final CTA - gradient (from-gray-50 to-white) -->
  <Section padding="lg" class="bg-gradient-to-b from-gray-50 to-white">
    <Container size="narrow" class="text-center">
      <h2 class="font-heading text-h2 mb-4">
        Ready to Get Started with Financing?
      </h2>
      <p class="font-body text-body-lg text-gray-600 mb-8 max-w-2xl mx-auto">
        Speak with our team to explore your financing options, get pre-qualified in minutes, and schedule your HVAC installation. We're here to make your upgrade affordable.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
        <PhoneCTA variant="hero" showBadge={false} />
        <BookingCTA variant="hero" />
      </div>

      <!-- Trust reassurance -->
      <div class="flex flex-wrap justify-center gap-6 text-sm font-body mt-8">
        <div class="flex items-center gap-2">
          <span>✓</span>
          <span>No Hidden Fees</span>
        </div>
        <div class="flex items-center gap-2">
          <span>✓</span>
          <span>Quick Approval</span>
        </div>
        <div class="flex items-center gap-2">
          <span>✓</span>
          <span>Multiple Lenders</span>
        </div>
        <div class="flex items-center gap-2">
          <span>✓</span>
          <span>0% APR Available</span>
        </div>
      </div>
    </Container>
  </Section>

  <!-- 8. QuickQuote Conversion Section - primary-light (conversion focus) -->
  <QuickQuoteConversionSection />
</BaseLayout>
