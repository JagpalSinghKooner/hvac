---
import { getEntry } from 'astro:content';
import { cn } from '@/lib/utils';
import { Phone } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';

const businessProfile = await getEntry('business', 'profile');
if (!businessProfile) {
  throw new Error('Business profile not found');
}
const business = businessProfile.data;

interface Props {
  variant?: 'header' | 'hero' | 'inline' | 'sticky' | 'footer' | 'emergency';
  showBadge?: boolean;
  class?: string;
}

const { variant = 'inline', showBadge = false, class: className } = Astro.props;

// Map PhoneCTA variants to Button component variants
const buttonVariants: Record<NonNullable<Props['variant']>, { variant: string; size: string; className?: string }> = {
  header: { variant: 'outline', size: 'sm' },
  hero: { variant: 'gradient', size: 'lg', className: 'shadow-glow-primary' },
  inline: { variant: 'gradient', size: 'default' },
  sticky: { variant: 'gradient', size: 'lg', className: 'shadow-glow-primary' },
  footer: { variant: 'link', size: 'default' },
  emergency: { variant: 'gradient-heating', size: 'lg', className: 'shadow-glow-secondary' }
};

const config = buttonVariants[variant];
---

<Button
  variant={config.variant as any}
  size={config.size as any}
  asChild
  className={cn(
    'gap-2',
    variant === 'emergency' && 'animate-pulse-slow',
    config.className,
    className
  )}
>
  <a href={`tel:${business.contact.phone_e164}`}>
    <Phone className={cn(
      'h-4 w-4',
      variant === 'emergency' && 'animate-pulse'
    )} />
    {variant === 'hero' && <span class="text-sm font-normal font-body">Call 24/7</span>}
    <span class="font-display">{business.contact.phone_display}</span>
    {showBadge && (
      <Badge variant="featured" className="ml-2 animate-pulse-slow">
        24/7
      </Badge>
    )}
  </a>
</Button>

<style>
  @media (prefers-reduced-motion: reduce) {
    .animate-pulse-slow,
    .animate-pulse {
      animation: none;
    }
  }
</style>
