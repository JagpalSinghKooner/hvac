---
import { getEntry } from 'astro:content';
import { Image } from 'astro:assets';
import { Separator } from '@/components/ui/separator';
import Section from '@/components/layout/Section.astro';
import Container from '@/components/layout/Container.astro';
import { MapPin, Phone, Mail, Clock, ChevronRight, Facebook, Instagram } from 'lucide-react';
import logo from '@/assets/images/bapheatingandcoolingltd.webp';

const businessProfile = await getEntry('business', 'profile');
if (!businessProfile) {
  throw new Error('Business profile not found');
}
const business = businessProfile.data;

const currentYear = new Date().getFullYear();

// Get top services from each category (first 5 across all categories)
const allServices = business.services?.list ? Object.values(business.services.list).flat() : [];
const topServices = allServices.slice(0, 8);

// Get all locations (flatten regions)
const allLocations = business.coverage?.regions?.flatMap((region: any) => region.locations) || [];
---

<Section as="footer" padding="lg" class="bg-muted/30 relative">
  <!-- Gradient top border -->
  <div class="absolute top-0 left-0 right-0 h-px gradient-brand" aria-hidden="true"></div>

  <Container>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      <!-- Company Info Column -->
      <div>
        <div class="mb-4 group">
          <div class="relative inline-block">
            <div
              class="absolute -inset-2 gradient-brand rounded-lg opacity-0 group-hover:opacity-20 blur-sm transition-opacity duration-300"
              aria-hidden="true"
            ></div>
            <Image
              src={logo}
              alt={business.business.legal_name}
              width={160}
              height={53}
              class="h-10 w-auto relative z-10 transition-transform duration-300 group-hover:scale-105"
              loading="lazy"
            />
          </div>
        </div>
        <div class="space-y-3 text-sm text-muted-foreground">
          <div class="flex items-start gap-2">
            <MapPin className="h-4 w-4 mt-0.5 shrink-0" />
            <span class="font-body">{business.locations?.primary?.address_full}</span>
          </div>
          <div class="flex items-center gap-2 group">
            <Phone className="h-4 w-4 shrink-0 text-primary group-hover:scale-110 transition-transform duration-200" />
            <a
              href={`tel:${business.contact.phone_e164}`}
              class="font-body hover:text-primary transition-colors underline-offset-4 hover:underline"
            >
              {business.contact.phone_display}
            </a>
          </div>
          <div class="flex items-center gap-2 group">
            <Mail className="h-4 w-4 shrink-0 text-primary group-hover:scale-110 transition-transform duration-200" />
            <a
              href={`mailto:${business.contact.email}`}
              class="font-body hover:text-primary transition-colors underline-offset-4 hover:underline"
            >
              {business.contact.email}
            </a>
          </div>
          <div class="flex items-start gap-2">
            <Clock className="h-4 w-4 mt-0.5 shrink-0" />
            <span class="font-body">{business.hours.business_hours} Emergency Service</span>
          </div>
        </div>
      </div>

      <!-- Services Column -->
      <div>
        <h3 class="font-heading font-semibold text-lg mb-4 text-foreground">Our Services</h3>
        <ul class="space-y-2">
          {topServices.map(service => (
            <li>
              <a
                href={`/services/${service.slug}/`}
                class="text-sm font-body text-muted-foreground hover:text-primary transition-all duration-200 inline-flex items-center gap-1 group"
              >
                <span class="group-hover:translate-x-1 transition-transform duration-200">
                  {service.title}
                </span>
                <ChevronRight className="h-3 w-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200" />
              </a>
            </li>
          ))}
        </ul>
      </div>

      <!-- Locations Column -->
      <div>
        <h3 class="font-heading font-semibold text-lg mb-4 text-foreground">Service Areas</h3>
        <ul class="space-y-2">
          {allLocations.slice(0, 8).map(location => (
            <li>
              <a
                href={`/locations/${location.slug}/`}
                class="text-sm font-body text-muted-foreground hover:text-primary transition-all duration-200 inline-flex items-center gap-1 group"
              >
                <span class="group-hover:translate-x-1 transition-transform duration-200">
                  {location.name}
                </span>
                <ChevronRight className="h-3 w-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200" />
              </a>
            </li>
          ))}
        </ul>
        {allLocations.length > 8 && (
          <a
            href="/locations/"
            class="text-sm font-body text-primary hover:underline underline-offset-4 mt-2 inline-flex items-center gap-1 group"
          >
            <span class="group-hover:translate-x-0.5 transition-transform duration-200">View all locations</span>
            <ChevronRight className="h-3 w-3 group-hover:translate-x-0.5 transition-transform duration-200" />
          </a>
        )}
      </div>

      <!-- About & Contact Column -->
      <div>
        <h3 class="font-heading font-semibold text-lg mb-4 text-foreground">Company</h3>
        <ul class="space-y-2 mb-6">
          <li>
            <a
              href="/about/"
              class="text-sm font-body text-muted-foreground hover:text-primary transition-all duration-200 inline-flex items-center gap-1 group"
            >
              <span class="group-hover:translate-x-1 transition-transform duration-200">About Us</span>
              <ChevronRight className="h-3 w-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200" />
            </a>
          </li>
          <li>
            <a
              href="/contact/"
              class="text-sm font-body text-muted-foreground hover:text-primary transition-all duration-200 inline-flex items-center gap-1 group"
            >
              <span class="group-hover:translate-x-1 transition-transform duration-200">Contact</span>
              <ChevronRight className="h-3 w-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200" />
            </a>
          </li>
          <li>
            <a
              href="/emergency-service/"
              class="text-sm font-body text-muted-foreground hover:text-primary transition-all duration-200 inline-flex items-center gap-1 group"
            >
              <span class="group-hover:translate-x-1 transition-transform duration-200">Emergency Service</span>
              <ChevronRight className="h-3 w-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200" />
            </a>
          </li>
          <li>
            <a
              href="/careers/"
              class="text-sm font-body text-muted-foreground hover:text-primary transition-all duration-200 inline-flex items-center gap-1 group"
            >
              <span class="group-hover:translate-x-1 transition-transform duration-200">Careers</span>
              <ChevronRight className="h-3 w-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200" />
            </a>
          </li>
          <li>
            <a
              href="/financing/"
              class="text-sm font-body text-muted-foreground hover:text-primary transition-all duration-200 inline-flex items-center gap-1 group"
            >
              <span class="group-hover:translate-x-1 transition-transform duration-200">Financing</span>
              <ChevronRight className="h-3 w-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200" />
            </a>
          </li>
          <li>
            <a
              href="/blog/"
              class="text-sm font-body text-muted-foreground hover:text-primary transition-all duration-200 inline-flex items-center gap-1 group"
            >
              <span class="group-hover:translate-x-1 transition-transform duration-200">Blog</span>
              <ChevronRight className="h-3 w-3 opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-200" />
            </a>
          </li>
        </ul>

        <!-- Social Media -->
        {(business as any).social && (
          <div>
            <h4 class="font-heading font-semibold text-sm mb-3">Follow Us</h4>
            <div class="flex gap-4">
              {(business as any).social.facebook && (
                <a
                  href={(business as any).social.facebook}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="relative group inline-flex items-center justify-center"
                  aria-label="Follow us on Facebook"
                >
                  <!-- Gradient ring background -->
                  <div
                    class="absolute inset-0 gradient-brand rounded-full opacity-0 group-hover:opacity-100 blur-sm transition-opacity duration-300 scale-0 group-hover:scale-110"
                    aria-hidden="true"
                  ></div>
                  <!-- Icon container -->
                  <div class="relative z-10 w-10 h-10 rounded-full border-2 border-muted-foreground group-hover:border-primary flex items-center justify-center transition-all duration-300 group-hover:scale-110 bg-background">
                    <Facebook className="h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors duration-300" />
                  </div>
                </a>
              )}
              {(business as any).social.instagram && (
                <a
                  href={(business as any).social.instagram}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="relative group inline-flex items-center justify-center"
                  aria-label="Follow us on Instagram"
                >
                  <!-- Gradient ring background -->
                  <div
                    class="absolute inset-0 gradient-brand rounded-full opacity-0 group-hover:opacity-100 blur-sm transition-opacity duration-300 scale-0 group-hover:scale-110"
                    aria-hidden="true"
                  ></div>
                  <!-- Icon container -->
                  <div class="relative z-10 w-10 h-10 rounded-full border-2 border-muted-foreground group-hover:border-primary flex items-center justify-center transition-all duration-300 group-hover:scale-110 bg-background">
                    <Instagram className="h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors duration-300" />
                  </div>
                </a>
              )}
            </div>
          </div>
        )}
      </div>
    </div>

    <Separator className="my-8" />

    <div class="flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-muted-foreground">
      <p class="font-body">Â© {currentYear} {business.business.legal_name}. All rights reserved.</p>
      <div class="flex gap-6">
        <a
          href="/privacy/"
          class="font-body hover:text-primary transition-colors hover:underline underline-offset-4 inline-flex items-center gap-1 group"
        >
          <span class="group-hover:translate-x-0.5 transition-transform duration-200">Privacy Policy</span>
        </a>
        <a
          href="/terms/"
          class="font-body hover:text-primary transition-colors hover:underline underline-offset-4 inline-flex items-center gap-1 group"
        >
          <span class="group-hover:translate-x-0.5 transition-transform duration-200">Terms of Service</span>
        </a>
      </div>
    </div>
  </Container>
</Section>

<style>
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .transition-transform,
    .transition-all,
    .transition-opacity,
    .transition-colors,
    .group:hover .transition-transform,
    .group:hover .transition-all {
      transition: none;
    }

    .group:hover svg,
    .group:hover div,
    .group:hover span {
      transform: none;
    }
  }
</style>
