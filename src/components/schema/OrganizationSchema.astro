---
import { getEntry } from 'astro:content';

const businessProfile = await getEntry('business', 'profile');
if (!businessProfile) {
  throw new Error('Business profile not found');
}
const business = businessProfile.data;

const siteURL = Astro.site?.toString() || 'https://bapheating.ca';

const schema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  'name': business.business.legal_name,
  'url': siteURL,
  'logo': `${siteURL}logo.png`,
  'description': business.copy_blocks.short_description,
  'foundingDate': business.business.established_year.toString(),
  'address': {
    '@type': 'PostalAddress',
    'streetAddress': business.locations?.primary.address_full.split(',')[0].trim() || '',
    'addressLocality': business.locations?.primary.city || '',
    'addressRegion': business.locations?.primary.province || '',
    'postalCode': business.locations?.primary.postal_code || '',
    'addressCountry': 'CA'
  },
  'contactPoint': {
    '@type': 'ContactPoint',
    'telephone': business.contact.phone_e164,
    'contactType': 'customer service',
    'areaServed': 'CA-ON',
    'availableLanguage': 'en',
    'hoursAvailable': {
      '@type': 'OpeningHoursSpecification',
      'dayOfWeek': [
        'Monday',
        'Tuesday',
        'Wednesday',
        'Thursday',
        'Friday',
        'Saturday',
        'Sunday'
      ],
      'opens': '00:00',
      'closes': '23:59'
    }
  },
  'sameAs': [
    business.social.instagram,
    business.social.facebook
  ].filter(Boolean),
  'aggregateRating': {
    '@type': 'AggregateRating',
    'ratingValue': business.reputation.google_rating.toString(),
    'reviewCount': business.reputation.google_review_count.toString()
  }
};
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
