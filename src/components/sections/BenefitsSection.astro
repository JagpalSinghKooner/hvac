---
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import Section from '@/components/layout/Section.astro';
import Container from '@/components/layout/Container.astro';
import * as Icons from 'lucide-react';
import { cn } from '@/lib/utils';
import type { ServiceBenefit } from '@/data/serviceContent';

interface Props {
  benefits: ServiceBenefit[];   // Required - array of benefits from serviceContent.ts
  heading?: string;              // Default: "Benefits"
  subheading?: string;           // Optional - additional context
  columns?: 2 | 3 | 4;          // Default: 2 - flexible grid layout
  class?: string;                // Custom classes for Section wrapper
}

const {
  benefits,
  heading = 'Benefits',
  subheading,
  columns = 2,
  class: className
} = Astro.props;

// Early return if no benefits
if (!benefits || benefits.length === 0) {
  return null;
}

// Grid classes configuration
const gridClasses: Record<2 | 3 | 4, string> = {
  2: 'grid-cols-1 md:grid-cols-2',           // Default - best for 5-6 benefits
  3: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3',  // For many benefits
  4: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-4'   // For short benefits
};

const gridClass = gridClasses[columns];

// Pre-process benefits to resolve icon components
const benefitsWithIcons = benefits.map(benefit => ({
  ...benefit,
  IconComponent: (Icons as any)[benefit.icon] || Icons.CheckCircle
}));
---

<Section padding="lg" class={className}>
  <Container>
    <!-- Heading Section (conditional) -->
    {(heading || subheading) && (
      <div class="text-center mb-12">
        {heading && (
          <h2 class="font-heading text-h2 text-center mb-4">
            {heading}
          </h2>
        )}
        {subheading && (
          <p class="font-body text-body-lg text-gray-600 text-center max-w-3xl mx-auto">
            {subheading}
          </p>
        )}
      </div>
    )}

    <!-- Benefits Grid -->
    <div class={cn('grid gap-6', gridClass)}>
      {benefitsWithIcons.map(benefit => (
        <Card className="text-center h-full flex flex-col group transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1">
          <CardHeader>
            {/* Gradient icon circle (brand gradient) */}
            <div class="relative w-12 h-12 rounded-full p-0.5 gradient-brand mx-auto mb-4 transition-transform duration-300 group-hover:scale-110">
              <div class="w-full h-full bg-white rounded-full flex items-center justify-center">
                <benefit.IconComponent className="h-6 w-6 text-primary transition-transform duration-300 group-hover:rotate-6" aria-hidden="true" />
              </div>
            </div>
            <CardTitle className="text-lg font-heading">{benefit.title}</CardTitle>
          </CardHeader>
          <CardContent className="flex-1">
            <p class="text-sm text-gray-600">{benefit.description}</p>
          </CardContent>
        </Card>
      ))}
    </div>
  </Container>
</Section>
