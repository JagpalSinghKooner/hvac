---
import { getCollection } from 'astro:content';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { ArrowRight } from 'lucide-react';

// Fetch latest 3 published blog posts
const allBlogPosts = await getCollection('blog');
const latestPosts = allBlogPosts
  .filter((post) => post.data.workflowStatus === 'published')
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .slice(0, 3);

// Format date helper
const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-CA', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date);
};
---

<section class="py-16 md:py-20 lg:py-24 bg-muted">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
    {/* Header */}
    <div class="text-center mb-8 md:mb-12">
      <h2 class="text-3xl md:text-4xl font-bold tracking-tight mb-4 md:mb-6">
        HVAC Tips & Advice from the Experts
      </h2>
      <p class="text-lg text-muted-foreground max-w-2xl mx-auto">
        Expert guidance to help you make informed decisions about your home comfort
      </p>
    </div>

    {/* Blog Posts Grid */}
    {latestPosts.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 mb-8 md:mb-12">
        {latestPosts.map((post) => (
          <Card className="h-full flex flex-col shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer">
            {/* Placeholder Image */}
            <div class="bg-muted aspect-[16/9] flex items-center justify-center text-muted-foreground text-sm border-b">
              Blog Thumbnail — 800×450
            </div>

            <CardHeader>
              <CardTitle className="line-clamp-2 text-xl">
                {post.data.title}
              </CardTitle>
              <CardDescription>
                {formatDate(post.data.publishDate)} • {post.data.author}
              </CardDescription>
            </CardHeader>

            <CardContent className="flex-grow flex flex-col">
              <p class="text-muted-foreground mb-4 line-clamp-3 flex-grow">
                {post.data.description}
              </p>
              <Button variant="link" className="p-0 h-auto self-start group" asChild>
                <a href={`/blog/${post.slug}`}>
                  Read More
                  <ArrowRight className="ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform" />
                </a>
              </Button>
            </CardContent>
          </Card>
        ))}
      </div>
    ) : (
      <div class="text-center py-12">
        <p class="text-muted-foreground">No blog posts available yet. Check back soon!</p>
      </div>
    )}

    {/* CTA */}
    {latestPosts.length > 0 && (
      <div class="flex justify-center">
        <Button variant="outline" size="lg" className="h-14 px-8" asChild>
          <a href="/blog">
            View All Articles
            <ArrowRight className="ml-2 w-4 h-4" />
          </a>
        </Button>
      </div>
    )}
  </div>
</section>
