---
import Section from '@/components/layout/Section.astro';
import Container from '@/components/layout/Container.astro';
import { CommonProblemsAccordion } from './CommonProblemsAccordion';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import PhoneCTA from '@/components/cta/PhoneCTA.astro';
import * as Icons from 'lucide-react';
import type { ServiceProblem } from '@/data/serviceContent';

interface Props {
  problems: ServiceProblem[];           // Required: Array of problems from serviceContent.ts
  heading?: string;                     // Optional: Default "Common Problems We Solve"
  subheading?: string;                  // Optional: Additional context below heading
  variant?: 'accordion' | 'grid';       // Optional: Default 'accordion'
  showCTA?: boolean;                    // Optional: Default true
  ctaText?: string;                     // Optional: Custom CTA text
  class?: string;                       // Optional: Custom wrapper classes
}

const {
  problems,
  heading = 'Common Problems We Solve',
  subheading,
  variant = 'accordion',
  showCTA = true,
  ctaText = 'Experiencing one of these issues? We can help.',
  class: className,
} = Astro.props;

// Early return if no problems provided
if (!problems || problems.length === 0) {
  return null;
}

// Pre-process problems to resolve icon components (Astro compatibility)
const problemsWithIcons = problems.map(problem => ({
  ...problem,
  IconComponent: (Icons as any)[problem.icon] || Icons.AlertTriangle
}));
---

<Section padding="lg" class={`bg-muted/30 ${className || ''}`}>
  <Container size="default">
    <!-- Heading Section -->
    <div class="text-center mb-12">
      <h2 class="font-heading text-h2 mb-4">{heading}</h2>
      {subheading && (
        <p class="text-body-lg text-gray-600 max-w-3xl mx-auto">{subheading}</p>
      )}
    </div>

    <!-- Accordion Variant -->
    {variant === 'accordion' && (
      <CommonProblemsAccordion problems={problems} client:load />
    )}

    <!-- Grid Variant -->
    {variant === 'grid' && (
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {problemsWithIcons.map((problem, index) => (
          <Card className="relative overflow-hidden hover:shadow-card-hover hover:-translate-y-1 transition-all duration-300 group" key={`problem-grid-${index}`}>
            <CardHeader>
              <div class="flex items-start gap-4">
                <div class="w-12 h-12 rounded-full bg-error/10 flex items-center justify-center flex-shrink-0 transition-transform duration-300 group-hover:scale-110">
                  <problem.IconComponent className="h-6 w-6 text-error" aria-hidden="true" />
                </div>
                <CardTitle className="font-heading text-lg">{problem.problem}</CardTitle>
              </div>
            </CardHeader>
            <CardContent>
              <p class="text-gray-600 font-body">{problem.solution}</p>
            </CardContent>
          </Card>
        ))}
      </div>
    )}

    <!-- PhoneCTA Section -->
    {showCTA && (
      <div class="mt-12 flex flex-col items-center gap-4">
        <p class="font-body text-body-lg font-semibold text-center text-gray-900">
          {ctaText}
        </p>
        <PhoneCTA variant="hero" class="w-full sm:w-auto" />
      </div>
    )}
  </Container>
</Section>
