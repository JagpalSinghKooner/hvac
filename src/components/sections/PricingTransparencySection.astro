---
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import Section from '@/components/layout/Section.astro';
import Container from '@/components/layout/Container.astro';
import PricingCard, { maintenancePlans } from '@/components/cards/PricingCard.astro';
import PhoneCTA from '@/components/cta/PhoneCTA.astro';
import { DollarSign, Shield, CheckCircle, Check } from 'lucide-react';
import { cn } from '@/lib/utils';
import { getEntry } from 'astro:content';

/**
 * Props Interface
 */
interface Props {
  heading?: string;                 // Default: "Transparent, No-Surprise Pricing"
  subheading?: string;              // Optional intro text
  showPricingCards?: boolean;       // Default: false - show maintenance plan cards
  showCTA?: boolean;                // Default: true - show PhoneCTA at bottom
  columns?: 2 | 3;                  // Grid columns, default: 3
  class?: string;                   // Custom wrapper classes
}

const {
  heading = 'Transparent, No-Surprise Pricing',
  subheading,
  showPricingCards = false,
  showCTA = true,
  columns = 3,
  class: className
} = Astro.props;

// Fetch business profile data
const businessProfile = await getEntry('business', 'profile');
const pricing = businessProfile?.data.pricing_and_offers;
const warranty = businessProfile?.data.warranty_and_guarantees;

// Grid classes configuration
const gridClasses: Record<2 | 3, string> = {
  2: 'grid-cols-1 md:grid-cols-2',
  3: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3'
};

const gridClass = gridClasses[columns];
---

<Section padding="lg" class={className}>
  <Container>
    <!-- Heading Section (conditional) -->
    {(heading || subheading) && (
      <div class="text-center mb-12">
        {heading && (
          <h2 class="font-heading text-h2 text-center mb-4">
            {heading}
          </h2>
        )}
        {subheading && (
          <p class="font-body text-body-lg text-gray-600 text-center max-w-3xl mx-auto">
            {subheading}
          </p>
        )}
      </div>
    )}

    <!-- Info Cards Grid -->
    <div class={cn('grid gap-6', gridClass)}>
      <!-- Card 1: Pricing Transparency -->
      <Card className="h-full flex flex-col border-t-4 border-t-primary group transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1">
        <CardHeader>
          {/* Gradient icon circle */}
          <div class="relative w-12 h-12 rounded-full p-0.5 gradient-brand mx-auto mb-4 transition-transform duration-300 group-hover:scale-110">
            <div class="w-full h-full bg-white rounded-full flex items-center justify-center">
              <DollarSign className="h-6 w-6 text-primary transition-transform duration-300 group-hover:rotate-6" aria-hidden="true" />
            </div>
          </div>
          <CardTitle className="text-lg text-center font-heading">How We Price</CardTitle>
        </CardHeader>
        <CardContent className="flex-1">
          <ul class="flex flex-col gap-3">
            {pricing?.estimates_free && pricing?.diagnostic_free && (
              <li class="flex items-start gap-3">
                <Check className="h-5 w-5 text-primary mt-0.5 flex-shrink-0" aria-hidden="true" />
                <span class="text-sm">Free estimates & diagnostics</span>
              </li>
            )}
            <li class="flex items-start gap-3">
              <Check className="h-5 w-5 text-primary mt-0.5 flex-shrink-0" aria-hidden="true" />
              <span class="text-sm">Upfront quotes before work begins</span>
            </li>
            {pricing?.financing?.available && (
              <li class="flex items-start gap-3">
                <Check className="h-5 w-5 text-primary mt-0.5 flex-shrink-0" aria-hidden="true" />
                <span class="text-sm">{pricing.financing.statement}</span>
              </li>
            )}
            {pricing?.rebates?.paperwork_supported && (
              <li class="flex items-start gap-3">
                <Check className="h-5 w-5 text-primary mt-0.5 flex-shrink-0" aria-hidden="true" />
                <span class="text-sm">{pricing.rebates.statement}</span>
              </li>
            )}
          </ul>
        </CardContent>
      </Card>

      <!-- Card 2: Warranty -->
      <Card className="h-full flex flex-col border-t-4 border-t-primary group transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1">
        <CardHeader>
          {/* Gradient icon circle */}
          <div class="relative w-12 h-12 rounded-full p-0.5 gradient-brand mx-auto mb-4 transition-transform duration-300 group-hover:scale-110">
            <div class="w-full h-full bg-white rounded-full flex items-center justify-center">
              <Shield className="h-6 w-6 text-primary transition-transform duration-300 group-hover:rotate-6" aria-hidden="true" />
            </div>
          </div>
          <CardTitle className="text-lg text-center font-heading">Warranty</CardTitle>
        </CardHeader>
        <CardContent className="flex-1">
          <p class="text-sm text-gray-600 text-center">
            {warranty?.warranty_statement}
          </p>
        </CardContent>
      </Card>

      <!-- Card 3: Guarantees -->
      <Card className="h-full flex flex-col border-t-4 border-t-primary group transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1">
        <CardHeader>
          {/* Gradient icon circle */}
          <div class="relative w-12 h-12 rounded-full p-0.5 gradient-brand mx-auto mb-4 transition-transform duration-300 group-hover:scale-110">
            <div class="w-full h-full bg-white rounded-full flex items-center justify-center">
              <CheckCircle className="h-6 w-6 text-primary transition-transform duration-300 group-hover:rotate-6" aria-hidden="true" />
            </div>
          </div>
          <CardTitle className="text-lg text-center font-heading">Our Guarantees</CardTitle>
        </CardHeader>
        <CardContent className="flex-1">
          <div class="flex flex-col gap-4">
            {warranty?.guarantee_primary && (
              <div>
                <strong class="text-sm font-semibold">{warranty.guarantee_primary.title}</strong>
                <p class="text-sm text-gray-600 mt-1">{warranty.guarantee_primary.copy}</p>
              </div>
            )}
            {warranty?.guarantee_secondary && (
              <div>
                <strong class="text-sm font-semibold">{warranty.guarantee_secondary.title}</strong>
                <p class="text-sm text-gray-600 mt-1">{warranty.guarantee_secondary.copy}</p>
              </div>
            )}
          </div>
        </CardContent>
      </Card>
    </div>

    <!-- Optional: Maintenance Plan Cards -->
    {showPricingCards && (
      <div class="mt-16">
        <h3 class="text-2xl font-semibold text-center mb-8">
          Maintenance Plans
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          {maintenancePlans.map(plan => (
            <PricingCard plan={plan} />
          ))}
        </div>
      </div>
    )}

    <!-- Optional: CTA Section -->
    {showCTA && (
      <div class="mt-12 flex flex-col items-center gap-4">
        <p class="text-muted-foreground text-center">
          Questions about pricing or ready to schedule?
        </p>
        <PhoneCTA variant="hero" />
      </div>
    )}
  </Container>
</Section>
