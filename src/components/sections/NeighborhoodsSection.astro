---
/**
 * NeighborhoodsSection Component
 *
 * Displays neighborhoods served in a specific city for local SEO and service area clarity.
 * Used on location pages to highlight specific neighborhoods within each city.
 *
 * @component
 * @example
 * ```astro
 * <NeighborhoodsSection citySlug="guelph" />
 * ```
 */

import Section from '@/components/layout/Section.astro';
import Container from '@/components/layout/Container.astro';
import { CheckCircle } from 'lucide-react';
import { cn } from '@/lib/utils';
import { getNeighborhoodsByCity } from '@/data/neighborhoods';

interface Props {
  /** City identifier (e.g., 'guelph', 'cambridge') - auto-fetches neighborhoods if provided */
  citySlug?: string;
  /** Optional - manually provide neighborhoods array */
  neighborhoods?: string[];
  /** Custom heading - defaults to "Neighborhoods We Serve in {City}" */
  heading?: string;
  /** Optional subheading for additional context */
  subheading?: string;
  /** Number of columns in grid (default: 4 for compact display) */
  columns?: 2 | 3 | 4;
  /** Optional - limit display to first N neighborhoods */
  limit?: number;
  /** Custom wrapper classes */
  class?: string;
}

const {
  citySlug,
  neighborhoods: providedNeighborhoods,
  heading,
  subheading,
  columns = 4,
  limit,
  class: className
} = Astro.props;

// Auto-fetch neighborhoods if not provided
let displayNeighborhoods: string[];

if (providedNeighborhoods) {
  displayNeighborhoods = providedNeighborhoods;
} else if (citySlug) {
  displayNeighborhoods = getNeighborhoodsByCity(citySlug);
} else {
  displayNeighborhoods = [];
}

// Apply limit if specified
if (limit && limit > 0) {
  displayNeighborhoods = displayNeighborhoods.slice(0, limit);
}

// Early return if no neighborhoods
if (!displayNeighborhoods || displayNeighborhoods.length === 0) {
  return null;
}

// Format city name for heading (capitalize each word, handle hyphens)
const cityName = citySlug
  ? citySlug.split('-').map(word =>
      word.charAt(0).toUpperCase() + word.slice(1)
    ).join(' ')
  : '';

// Compute default heading
const finalHeading = heading ?? (cityName
  ? `Neighborhoods We Serve in ${cityName}`
  : 'Service Areas & Neighborhoods');

// Compute grid classes for responsive layout
const gridClasses: Record<2 | 3 | 4, string> = {
  2: 'grid-cols-1 md:grid-cols-2',
  3: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3',
  4: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-4'
};

const gridClass = gridClasses[columns];
---

<Section padding="lg" class={className}>
  <Container>
    <!-- Heading Section -->
    {(finalHeading || subheading) && (
      <div class="text-center mb-12">
        {finalHeading && (
          <h2 class="text-3xl font-semibold mb-4">
            {finalHeading}
          </h2>
        )}
        {subheading && (
          <p class="text-lg text-muted-foreground max-w-3xl mx-auto">
            {subheading}
          </p>
        )}
      </div>
    )}

    <!-- Neighborhoods Grid -->
    <ul class={cn('grid gap-4', gridClass)}>
      {displayNeighborhoods.map((neighborhood) => (
        <li class="flex items-center gap-3">
          <CheckCircle
            className="h-5 w-5 text-primary flex-shrink-0"
            aria-hidden="true"
          />
          <span class="text-base">{neighborhood}</span>
        </li>
      ))}
    </ul>
  </Container>
</Section>
