---
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Check } from 'lucide-react';
import { cn } from '@/lib/utils';
import PhoneCTA from '@/components/cta/PhoneCTA.astro';

/**
 * Maintenance Plan Interface
 * Defines the structure for HVAC maintenance plan pricing tiers
 */
interface MaintenancePlan {
  name: string;           // Plan name (e.g., "Basic", "Premium", "Commercial")
  price: string;          // Price display (e.g., "$99/year" or "Custom")
  description: string;    // 1-2 sentence plan summary
  features: string[];     // List of included features
  recommended?: boolean;  // If true, displays "Most Popular" badge
}

/**
 * Component Props
 */
interface Props {
  plan: MaintenancePlan;
  class?: string;
}

/**
 * Placeholder Maintenance Plans Data
 * These are realistic HVAC maintenance plan tiers for Southern Ontario
 * Replace with actual pricing and features from business owner
 */
export const maintenancePlans: MaintenancePlan[] = [
  {
    name: 'Basic',
    price: '$99/year',
    description: 'Essential maintenance for reliable home comfort.',
    features: [
      'Annual furnace inspection & tune-up',
      'Annual AC inspection & tune-up',
      'Priority service scheduling',
      '10% discount on repairs'
    ]
  },
  {
    name: 'Premium',
    price: '$199/year',
    description: 'Comprehensive protection with priority emergency service.',
    features: [
      'Everything in Basic plan',
      'Bi-annual system inspections',
      'Air filter replacements included',
      '15% discount on repairs',
      'Priority emergency response (2-hour window)'
    ],
    recommended: true
  },
  {
    name: 'Commercial',
    price: 'Custom',
    description: 'Tailored maintenance for businesses and multi-unit properties.',
    features: [
      'Customized maintenance schedule',
      'Dedicated service technician',
      'Quarterly system inspections',
      'Emergency 24/7 support'
    ]
  }
];

// Props destructuring with defensive defaults
const { plan, class: className } = Astro.props;

const planName = plan.name || 'Unnamed Plan';
const planPrice = plan.price || 'Contact Us';
const planDescription = plan.description || '';
const planFeatures = plan.features && plan.features.length > 0 ? plan.features : ['Contact us for details'];
const isRecommended = plan.recommended === true;
---

<div class={cn(
  isRecommended && 'p-[2px] rounded-lg gradient-brand',
  !isRecommended && 'p-0'
)}>
  <Card
    className={cn(
      'h-full flex flex-col relative group transition-all duration-300 hover:shadow-card-hover hover:-translate-y-2',
      isRecommended && 'border-0',
      className
    )}
  >
    {isRecommended && (
      <div class="absolute -top-3 left-1/2 -translate-x-1/2 z-10">
        <Badge
          className="gradient-brand text-white shadow-glow-primary animate-pulse-slow border-0 px-4 py-1.5 text-sm font-bold"
          aria-label="Most popular plan"
        >
          <span class="flex items-center gap-1.5">
            <svg
              class="h-4 w-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
            </svg>
            Most Popular
          </span>
        </Badge>
      </div>
    )}

  <CardContent className="p-6 flex flex-col gap-6 flex-1">
    <!-- Plan Name -->
    <h3 class="text-2xl lg:text-3xl font-bold text-center">
      {planName}
    </h3>

    <!-- Price -->
    <div class="text-center">
      <div class="text-4xl font-bold text-primary">
        {planPrice}
      </div>
    </div>

    <!-- Description -->
    {planDescription && (
      <p class="text-sm text-muted-foreground text-center">
        {planDescription}
      </p>
    )}

    <!-- Features List with staggered animation -->
    <ul class="flex flex-col gap-3 flex-1">
      {planFeatures.map((feature, index) => (
        <li
          class="flex items-start gap-3 feature-item opacity-0"
          style={`animation-delay: ${index * 80}ms;`}
        >
          <div class="w-5 h-5 mt-0.5 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
            <Check className="h-3.5 w-3.5 text-primary font-bold" aria-hidden="true" />
          </div>
          <span class="text-sm text-foreground leading-relaxed">
            {feature}
          </span>
        </li>
      ))}
    </ul>

    <!-- CTA Section -->
    <div class="pt-4 border-t">
      <PhoneCTA variant="inline" class="w-full justify-center" />
    </div>
  </CardContent>
  </Card>
</div>

<style>
  .feature-item {
    animation: fadeInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .feature-item {
      opacity: 1;
      animation: none;
    }
  }
</style>
