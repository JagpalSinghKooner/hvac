---
import Section from '@/components/layout/Section.astro';
import Container from '@/components/layout/Container.astro';
import { Button } from '@/components/ui/button';
import TrustBadges from '@/components/TrustBadges.astro';
import { Phone, Calendar } from 'lucide-react';
import { getEntry } from 'astro:content';

interface Props {
  service: {
    title: string;
    description?: string;
    hero_heading?: string;
    hero_subheading?: string;
    category?: 'heating' | 'cooling' | 'iaq' | 'water-heating' | 'commercial' | 'plans';
  };
}

const { service } = Astro.props;

// Use custom hero heading if provided, otherwise use title
const heading = service.hero_heading || service.title;
const subheading = service.hero_subheading || service.description || '';

// Category-based theming for atmospheric backgrounds
const isHeating = service.category === 'heating';
const isCooling = service.category === 'cooling';
const backgroundClass = isHeating
  ? 'gradient-mesh-warm'
  : isCooling
    ? 'gradient-mesh-cool'
    : 'gradient-mesh-cool';

// Category-specific button variant
const buttonVariant = isHeating
  ? 'gradient-heating'
  : isCooling
    ? 'gradient-cooling'
    : 'gradient';

// Get business phone
const businessEntry = await getEntry('business', 'profile');
const business = businessEntry!.data;
const phone = business.contact.phone_display;
---

<Section padding="lg" class="relative overflow-hidden">
  <!-- Category-themed mesh gradient background -->
  <div class={`absolute inset-0 ${backgroundClass} -z-10`} aria-hidden="true"></div>

  <!-- Animated floating shapes - color varies by category -->
  {isHeating ? (
    <>
      <div
        class="absolute top-20 left-[10%] w-64 h-64 bg-secondary-200/40 rounded-full blur-3xl animate-float pointer-events-none"
        aria-hidden="true"
      ></div>
      <div
        class="absolute bottom-20 right-[10%] w-96 h-96 bg-secondary-100/30 rounded-full blur-3xl animate-float-delayed pointer-events-none"
        aria-hidden="true"
      ></div>
    </>
  ) : (
    <>
      <div
        class="absolute top-20 left-[10%] w-64 h-64 bg-primary-200/30 rounded-full blur-3xl animate-float pointer-events-none"
        aria-hidden="true"
      ></div>
      <div
        class="absolute bottom-20 right-[10%] w-96 h-96 bg-primary-100/20 rounded-full blur-3xl animate-float-delayed pointer-events-none"
        aria-hidden="true"
      ></div>
    </>
  )}

  <!-- Content with higher z-index for layering -->
  <Container size="narrow" class="relative z-10 text-center">
    <!-- Enhanced typography with custom display font and text shadow -->
    <h1 class="font-display text-display-md lg:text-display-lg text-shadow-soft mb-6">
      {heading}
    </h1>

    {subheading && (
      <p class="font-body text-body-lg text-gray-600 max-w-2xl mx-auto mb-8">
        {subheading}
      </p>
    )}

    <!-- Category-specific gradient CTA buttons -->
    <div class="flex flex-col sm:flex-row gap-4 justify-center mb-12">
      <Button variant={buttonVariant} size="lg" className="gap-2" client:load>
        <Phone className="h-5 w-5" />
        {phone}
      </Button>
      <Button variant="outline" size="lg" className="gap-2" client:load>
        <Calendar className="h-5 w-5" />
        Book Online
      </Button>
    </div>

    <!-- Enhanced TrustBadges with glassmorphism -->
    <div class="trust-badges-enhanced">
      <TrustBadges />
    </div>
  </Container>
</Section>

<style>
  /* Text shadow for heading depth */
  .text-shadow-soft {
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  /* Floating animation for atmospheric shapes */
  @keyframes float {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-20px);
    }
  }

  .animate-float {
    animation: float 8s ease-in-out infinite;
  }

  .animate-float-delayed {
    animation: float 8s ease-in-out 2s infinite;
  }

  /* Glassmorphism enhancement for trust badges */
  .trust-badges-enhanced :global(.trust-badge),
  .trust-badges-enhanced :global(> div > div) {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  /* Ensure animations respect user preferences */
  @media (prefers-reduced-motion: reduce) {
    .animate-float,
    .animate-float-delayed {
      animation: none;
    }
  }
</style>
